# Ethereum nodejs server

#### Versions 
Command for checking versions is 
npm list 'package' or npm ls 'package'
or
yarn info 'package' version

If we want to downgrade the version of the package, we do
yarn add package@version

#### Recomended dependencies
Web3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.20.1
truffle-contract&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.0.1
truffle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.0.7

### Contract Deployment with Truffle

#### 1* Step: 
Be sure that some network either as ganache, 'truffle develop' command, or any local blockchain is up and running.
Is important to notice the host, port and the network id for the contracts
IMPORTAT: Better use ganache-gui since truffle develop doesnt give enough gas
ganache-gui needs:
-   download from the repo https://github.com/trufflesuite/ganache
-   yarn install (yarn is better)
-   yarn start

#### 2* Step:
Be sure to modify the contract according with the requirements of the application and to modify the 'migrations' folder with the deployment of the solidity contracts

#### 3* Step:
truffle compile (in application location)
 
#### 4* Step:
Check that there was a modification on the JSON file of the contract in build folder. Check that the network id of the running blockchain is on the JSON file of that contract

#### 5* Step:
trufle migrate --reset (This migrate the compile JSON files into the network and if there is no errors, the contract has been deployed in the local network)

#### 6* Step:
Develop the middleware that gets in contact with the local blockchain. Commonly we will use web3 and some framework for the contracts.

Usually we do something like(NodeJs):

```
const contractTruffle = require('truffle-contract');  //npm package
const contract_artifact = require('../build/contracts/Tracks.json'); //we build a JSON artifact
const Contract = contractTruffle(track_artifact); //we get the contract JSON artifact
const Web3 = require('web3');  //npm package

const web3Provider = new Web3(new Web3.providers.HttpProvider("http://host:port")); //we create the network provider
Contract.setProvider(web3Provider.currentProvider); //we set the network provider

const instanceEthInterface = await TrackContract.deployed(); //using async/await we create the instance of the contract deployed in the network 

```
Important: Be aware of the gas limit that usually the network gives

#Error Handling as we find errors
TypeError: Cannot read property 'constructor' of undefined //When calling a contract with web3, was solved by adding a name of the variable in the event definitions. 

To return values from the web3, we need to return a view. More information in this link:

https://ethereum.stackexchange.com/questions/28898/when-to-use-view-and-pure-in-place-of-constant

This is the way of creating personal accounts 
https://stackoverflow.com/questions/50239320/how-can-i-create-a-new-account-or-address-with-web3-js
 The design is going to be to take specific accounts generated by ganache client 